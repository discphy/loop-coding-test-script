# 슬랙 명령어 가이드

코테 챌린지 시스템의 Slack 슬래시 커맨드 사용 가이드입니다.

---

## 📋 목차

- [챌린지 참여 관련](#챌린지-참여-관련)
  - [/코테챌린지참여](#코테챌린지참여)
  - [/코테챌린지참여확인](#코테챌린지참여확인)
  - [/코테챌린지현황](#코테챌린지현황)
- [제출 관련](#제출-관련)
  - [/코테제출](#코테제출)
  - [/코테제출수정](#코테제출수정)
  - [/코테제출확인](#코테제출확인)
- [관리자 기능](#관리자-기능)
  - [/코테집계](#코테집계)

---

## 챌린지 참여 관련

### /코테챌린지참여

**설명:** 코테 챌린지에 참여 신청을 합니다.

**사용법:**
```
/코테챌린지참여
```

**동작 방식:**
1. `challengers` 시트에 사용자 정보 추가
2. 등록 일시 기록 (yyyy-MM-dd HH:mm:ss)
3. 다음 날 자정부터 일일 집계 대상에 포함

**정책:**
- 중복 참여 불가 - 이미 참여 중인 경우 "이미 챌린지에 참여 중입니다!" 메시지 반환
- 참여 취소는 관리자에게 문의 필요

**응답 메시지:**
- 성공: `🎉 코테 챌린지 참여 완료! 매일 코딩 테스트를 제출해주세요!`
- 실패: `⚠️ 이미 챌린지에 참여 중입니다!`

---

### /코테챌린지참여확인

**설명:** 현재 챌린지 참여 여부와 진행 일차를 확인합니다.

**사용법:**
```
/코테챌린지참여확인
```

**동작 방식:**
1. `challengers` 시트에서 사용자 조회
2. 등록일로부터 현재까지 경과 일수 계산
3. 등록 당일을 1일차로 계산

**정책:**
- 챌린저만 조회 가능
- 미참여자는 참여 유도 메시지 표시

**응답 메시지:**
- 참여 중: `🏆 챌린지 5일차입니다! 오늘도 화이팅하세요! 💪`
- 미참여: `📢 아직 챌린지에 참여하지 않으셨습니다! /코테챌린지참여 명령어로 지금 바로 참여하세요! 🚀`

---

### /코테챌린지현황

**설명:** 본인의 챌린지 성공 횟수와 경고 횟수를 확인합니다.

**사용법:**
```
/코테챌린지현황
```

**동작 방식:**
1. `challenger-stats` 시트에서 사용자 통계 조회
2. 총 제출 성공 횟수와 누적 경고 횟수 표시

**정책:**
- 챌린저만 조회 가능
- 첫 집계 전에는 "아직 통계가 없습니다" 메시지 표시
- 통계는 매일 자정 스케줄러가 자동 업데이트

**응답 메시지:**
- 통계 존재: `📊 나의 챌린지 현황\n✅ 성공: 5회\n⚠️ 경고: 1회`
- 통계 없음: `📊 아직 통계가 없습니다! 첫 집계는 챌린지 참여 후 다음 날부터 시작됩니다.`
- 미참여: `📢 아직 챌린지에 참여하지 않으셨습니다! /코테챌린지참여 명령어로 지금 바로 참여하세요! 🚀`

---

## 제출 관련

### /코테제출

**설명:** 코테 PR 링크를 제출합니다.

**사용법:**
```
/코테제출 https://github.com/org/repo/pull/123
```

**동작 방식:**
1. GitHub PR 링크 형식 검증
2. 당일 제출 여부 확인 (하루 1회 제한)
3. 중복 링크 확인 (과거 제출 이력)
4. `daily-challenge` 시트에 기록 저장
   - 날짜(yyyy-MM-dd), 사용자명, PR 링크, 시간(HH:mm:ss)

**정책:**
- **하루 1회 제출 제한** - 당일 이미 제출한 경우 제출 불가
- **GitHub PR 링크 필수** - `https://github.com/{owner}/{repo}/pull/{number}` 형식만 허용
- **중복 링크 금지** - 과거에 제출한 PR 링크는 재사용 불가
- 제출 수정은 `/코테제출수정` 명령어 사용

**링크 형식 예시:**
- ✅ `https://github.com/loopers/algorithm/pull/123`
- ❌ `http://github.com/loopers/algorithm/pull/123` (http 불가)
- ❌ `https://github.com/loopers/algorithm/pulls/123` (pulls 불가)
- ❌ `https://github.com/loopers/algorithm/pull/abc` (숫자만 가능)

**응답 메시지:**
- 성공: `✅ 코테 제출 완료!\n📎 https://github.com/org/repo/pull/123`
- 형식 오류: `❌ 올바른 GitHub PR 링크를 입력해주세요!\n예시: https://github.com/org/repo/pull/123`
- 중복 제출: `⚠️ 오늘 이미 제출하셨습니다!`
- 중복 링크: `❌ 이미 등록한 PR 링크입니다!`

---

### /코테제출수정

**설명:** 오늘 제출한 PR 링크를 수정합니다.

**사용법:**
```
/코테제출수정 https://github.com/org/repo/pull/456
```

**동작 방식:**
1. GitHub PR 링크 형식 검증
2. 오늘 제출 이력 존재 여부 확인
3. 중복 링크 확인 (과거 제출 이력)
4. 기존 제출 내역의 PR 링크와 시간 업데이트

**정책:**
- **오늘 제출한 이력 필수** - 제출 이력이 없으면 수정 불가
- **GitHub PR 링크 필수** - 동일한 형식 검증 적용
- **중복 링크 금지** - 과거 다른 날짜에 제출한 링크는 사용 불가
- 수정 시 제출 시간도 함께 업데이트

**응답 메시지:**
- 성공: `✏️ 코테 제출 수정 완료!\n📎 https://github.com/org/repo/pull/456`
- 형식 오류: `❌ 올바른 GitHub PR 링크를 입력해주세요!\n예시: https://github.com/org/repo/pull/123`
- 제출 없음: `⚠️ 오늘 제출한 이력이 없습니다!\n먼저 /코테제출 명령어로 제출해주세요.`
- 중복 링크: `❌ 이미 등록한 PR 링크입니다!`

---

### /코테제출확인

**설명:** 오늘 제출한 PR 링크를 확인합니다.

**사용법:**
```
/코테제출확인
```

**동작 방식:**
1. `daily-challenge` 시트에서 오늘 날짜 조회
2. 제출 날짜, 시간, PR 링크 표시

**정책:**
- 당일 제출 이력만 조회 가능
- 과거 제출 이력은 Google Sheets에서 직접 확인

**응답 메시지:**
- 제출 존재: `📋 제출 이력 확인\n🕒 2025-10-23 14:30:00에\n📎 https://github.com/org/repo/pull/123가 제출되었습니다.`
- 제출 없음: `⚠️ 오늘 제출한 이력이 없습니다!\n먼저 /코테제출 명령어로 제출해주세요.`

---

## 관리자 기능

### /코테집계

**설명:** 집계를 조회하거나 수동으로 실행합니다. (관리자 채널 전용)

**사용법:**
```
/코테집계                    # 오늘 날짜 집계 조회 (저장 안함)
/코테집계 2025-10-22         # 특정 날짜 집계 실행 (저장 + 통계 업데이트)
```

**동작 방식:**

**조회 모드** (날짜 파라미터 없음):
1. 오늘 날짜 기준으로 집계 데이터 계산
2. 결과만 반환 (저장하지 않음)
3. 제출자/미제출자 목록 표시

**실제 집계 모드** (날짜 파라미터 있음):
1. 지정한 날짜의 집계 실행
2. `aggregation` 시트에 저장
3. `challenger-stats` 시트 업데이트 (경고 누적 포함)
4. Slack 일반 채널에 결과 요약 전송
5. 경고 초과 시 관리자 채널 알림

**권한:**
- 관리자 채널에서만 사용 가능
- `ADMIN_CHANNEL_ID`로 권한 검증
- 일반 채널에서 실행 시 권한 오류 메시지

**정책:**
- **중복 집계 방지** - 이미 집계된 날짜는 재집계 불가
- **날짜 형식 검증** - `yyyy-MM-dd` 형식만 허용
- **스케줄러 독립** - 자동 스케줄러와 동일한 로직 사용

**응답 메시지:**

조회 모드:
```
📊 2025-10-23 집계 조회
👥 총 챌린저: 10명
✅ 제출 성공: 8명
❌ 미제출: 2명
📈 성공률: 80.00%

✅ 제출자: user1, user2, ...
⚠️ 미제출자: user9, user10
```

실제 집계 모드:
```
✅ 2025-10-22 집계 완료!
👥 총 챌린저: 10명
✅ 제출 성공: 8명
❌ 미제출: 2명
📈 성공률: 80.00%

📝 집계 데이터 저장 완료
📊 챌린저 통계 업데이트 완료
🔔 Slack 알림 전송 완료

✅ 제출자: user1, user2, ...
⚠️ 미제출자: user9, user10
```

에러 메시지:
- 권한 없음: `🚫 이 명령을 수행할 권한이 없습니다.`
- 날짜 형식 오류: `❌ 잘못된 날짜 형식입니다.\n올바른 형식: yyyy-MM-dd (예: 2025-10-22)`
- 중복 집계: `⚠️ 2025-10-22은(는) 이미 집계되었습니다.\n중복 집계가 불가합니다.`

**사용 시나리오:**
- 스케줄러 미작동 시 수동 집계
- 특정 날짜 재집계 필요 시
- 실시간 집계 현황 확인

---

## 경고 및 퇴출 시스템

### 경고 누적 정책

- **미제출 시 경고 +1** - 매일 자정 집계 시 미제출자에게 경고 부여
- **경고 임계값: 2회** - 경고가 2회를 초과하면 퇴출 대상
- **자동 알림** - 경고 초과 시 관리자 Slack 채널로 자동 알림
  - 알림 형식: `⚠️ 퇴출 필요 | {챌린저명}님 경고 3회로 퇴출이 필요합니다.`

### 일일 집계 시스템

**실행 시간:** 매일 자정 (00:00 ~ 01:00)

**집계 내용:**
1. 전날 챌린저별 제출 여부 확인
2. 제출 성공/미제출 횟수 업데이트
3. 미제출 시 경고 누적
4. 경고 초과 시 관리자 알림 전송
5. 일반 Slack 채널에 결과 요약 전송
   - 메시지: `오늘 하루도 고생하셨습니다. 8명 챌린지 완료 ✅, 2명 챌린지 실패 ❌`

**데이터 저장:**
- `aggregation` 시트: 전체 일일 집계
- `challenger-stats` 시트: 챌린저별 누적 통계

---

## 시트 구조

### challengers
챌린저 명단 관리
- 사용자명, Slack ID, 등록일시

### daily-challenge
일일 제출 기록
- 날짜, 사용자명, PR 링크, 시간

### challenger-stats
챌린저별 통계
- 챌린저명, 총 제출 성공, 총 미제출, 누적 경고, 상태, 마지막 업데이트

### aggregation
일일 전체 집계
- 날짜, 챌린저 수, 제출 성공, 미제출, 성공률(%)

---

## FAQ

**Q: 챌린지 참여를 취소하고 싶어요.**  
A: 관리자에게 문의해주세요. `challengers` 시트에서 수동으로 제거할 수 있습니다.

**Q: 경고를 초기화할 수 있나요?**  
A: 관리자가 `challenger-stats` 시트에서 수동으로 조정할 수 있습니다.

**Q: 과거 제출 이력을 확인하고 싶어요.**  
A: Google Sheets의 `daily-challenge` 시트에서 직접 확인하거나 관리자에게 문의해주세요.

**Q: PR 링크를 잘못 제출했어요.**  
A: 당일에 한해 `/코테제출수정` 명령어로 수정 가능합니다.

**Q: 주말이나 휴일에도 제출해야 하나요?**  
A: 현재는 매일 집계되므로 주말/휴일도 제출이 필요합니다. 정책 변경이 필요한 경우 관리자에게 문의해주세요.
